# NixOS Template Configuration

A modular NixOS configuration using flakes, featuring suckless utilities (dwm, dmenu, st, slstatus) and profile-based system setups.

## ğŸ“ Structure Overview

```
.
â”œâ”€â”€ config/              # Suckless utilities configuration headers
â”‚   â”œâ”€â”€ dmenu/
â”‚   â”œâ”€â”€ dwm/
â”‚   â”œâ”€â”€ slstatus/
â”‚   â””â”€â”€ st/
â”œâ”€â”€ flake.nix           # Main flake configuration with host definitions
â”œâ”€â”€ flake.lock          # Locked dependency versions
â”œâ”€â”€ hosts/              # Host-specific configurations
â”‚   â””â”€â”€ nixos-desktop/
â”œâ”€â”€ modules/            # Modular system components
â”‚   â”œâ”€â”€ applications/   # Application packages and configurations
â”‚   â”œâ”€â”€ core/          # Essential system setup (users, boot, services)
â”‚   â”œâ”€â”€ desktop/       # Window manager configurations
â”‚   â””â”€â”€ drivers/       # Hardware driver modules
â””â”€â”€ profiles/          # Hardware profiles (presets for driver selection)
    â”œâ”€â”€ amd/
    â”œâ”€â”€ intel/
    â”œâ”€â”€ nvidia/
    â”œâ”€â”€ nvidia-laptop/
    â””â”€â”€ vm/
```

## ğŸ¯ Key Concepts

### The Module System

NixOS modules work similarly to Rust's module system. A `default.nix` file acts like `mod.rs` - it's the entry point that imports and exposes other modules in the directory. When you import a directory in Nix, it automatically looks for `default.nix`.

### Flake Architecture

The `flake.nix` uses a helper function `mkHost` to create host configurations:

```nix
mkHost = { hostname, profile, username, }: 
  nixpkgs.lib.nixosSystem {
    # ...
    modules = [
      ./hosts/${hostname}      # Host-specific config
      ./profiles/${profile}    # Hardware profile
      ./modules/applications   # Apps and packages
      ./modules/core          # System essentials
      ./modules/desktop       # Window managers
    ];
  };
```

This function automatically imports all necessary modules for each host, allowing you to define a complete system with just three parameters.

## ğŸ“¦ Module Breakdown

### Core (`modules/core/`)
The foundation of your system. Handles:
- **User Management** (`user.nix`) - Creates and configures user accounts
- **Boot Configuration** (`boot.nix`) - Bootloader and kernel settings
- **System Services** (`services.nix`) - Essential background services
- **Fonts** (`fonts.nix`) - System-wide font configuration

### Applications (`modules/applications/`)
All user-facing software and packages:
- Application installations
- Package configurations
- Program-specific settings

### Desktop (`modules/desktop/`)
Window manager and desktop environment setup:
- **Suckless utilities** (dwm, dmenu, st, slstatus)
- Desktop-specific services
- Display server configuration
- Xserver or wayland setup

### Drivers (`modules/drivers/`)
Hardware support modules:
- `amd-drivers.nix` - AMD GPU support
- `intel-drivers.nix` - Intel GPU support
- `nvidia-drivers.nix` - NVIDIA GPU support
- `nvidia-prime-drivers.nix` - NVIDIA Optimus/PRIME for laptops
- `vm-guest-services.nix` - Virtual machine guest tools
- `local-hardware-clock.nix` - RTC configuration

### Profiles (`profiles/`)
Pre-configured hardware presets that enable appropriate drivers:
- `amd/` - AMD GPU systems
- `intel/` - Intel GPU systems
- `nvidia/` - NVIDIA desktop systems
- `nvidia-laptop/` - NVIDIA laptops with Optimus
- `vm/` - Virtual machine guests

## ğŸš€ Usage

### Creating a New Host

Add a new configuration in `flake.nix`:

```nix
nixosConfigurations = {
  my-laptop = mkHost {
    hostname = "my-laptop";
    profile = "nvidia-laptop";
    username = "myuser";
  };
};
```

Then create the host directory:

```bash
mkdir -p hosts/my-laptop
```

Add at minimum:
- `default.nix` - Main host configuration
- `hardware.nix` - Hardware-specific settings (generated by nixos-generate-config)

### Building and Switching

```bash
# Build the configuration
sudo nixos-rebuild build --flake .#my-laptop

# Switch to the new configuration
sudo nixos-rebuild switch --flake .#my-laptop
```

### Selecting a Profile

Choose a profile based on your hardware:
- **AMD GPU** â†’ `profile = "amd";`
- **Intel GPU** â†’ `profile = "intel";`
- **NVIDIA Desktop** â†’ `profile = "nvidia";`
- **NVIDIA Laptop** â†’ `profile = "nvidia-laptop";`
- **Virtual Machine** â†’ `profile = "vm";`

## ğŸ”§ Customization

### Modifying Suckless Tools

Configuration headers are in `config/` and `modules/desktop/suckless/`. Edit the appropriate `config.h` or `config.nix` file, then rebuild.

### Adding New Modules

1. Create your module in the appropriate directory (`applications/`, `core/`, etc.)
2. Import it in the directory's `default.nix`
3. The module will automatically be included in all hosts

### Host-Specific Settings

Place unique configurations in `hosts/<hostname>/`:
- `default.nix` - Main imports and host settings
- `hardware.nix` - Hardware scan results
- `host-packages.nix` - Host-specific packages
- `variables.nix` - Host-specific variables

## ğŸ“ Benefits of This Structure

- **Modularity** - Each component is isolated and reusable
- **Profile System** - Quick hardware configuration switching
- **DRY Principle** - Shared configs are defined once
- **Easy Management** - Add new hosts with minimal code
- **Clear Organization** - Purpose of each directory is obvious

## ğŸ› ï¸ Example: Default Configuration

The `default` host serves as a template:

```nix
default = mkHost {
  hostname = "default";
  profile = "amd";
  username = "user";
};
```

Users can copy this as a starting point for their own installations.

Template based on:
https://gitlab.com/theblackdon/black-don-os
https://gitlab.com/Zaney/zaneyos
